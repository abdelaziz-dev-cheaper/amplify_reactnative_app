version: 1
backend:
  phases:
    preBuild:
      commands:
        - echo "ðŸ”§ Setting Node.js version to 22"
        - nvm install 22
        - nvm use 22
        - npm install -g npm@latest
        - echo "âœ… Node version: $(node -v)"
        - echo "âœ… NPM version: $(npm -v)"
    build:
      commands:
        - echo "ðŸš€ Deploying Amplify Gen 2 backend"
        - npx ampx pipeline-deploy --branch $AWS_BRANCH --app-id $AWS_APP_ID
  cache:
    paths:
      - node_modules/**/*
      - ~/.npm/**/*
artifacts:
  baseDirectory: .
  files:
    - amplify/**/*

frontend:
  phases:
    preBuild:
      commands:
        - echo "No frontend build â€“ backend only app"
    build:
      commands:
        - echo "Skipping frontend build"
  artifacts:
    baseDirectory: .
    files:
      - amplify.yml
  cache:
    paths:
      - node_modules/**/*
